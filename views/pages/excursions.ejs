<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('../partials/head') %>
    <style>
        /* GetYourGuide inspired styles */
        :root {
            --primary-color: #3498db;
            --primary-dark: #2980b9;
            --secondary-color: #2c3e50;
            --gray-light: #f5f5f5;
            --gray-medium: #e0e0e0;
            --gray-text: #666;
            --border-radius: 8px;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: #333;
            background-color: #f7f7f7;
            line-height: 1.6;
        }
        
        .section {
            margin-bottom: 2rem;
        }
        
        .card {
            border-radius: var(--border-radius);
            border: 1px solid var(--gray-medium);
            background-color: white;
            overflow: hidden;
            transition: border-color 0.2s ease;
        }
        
        .card:hover {
            border-color: var(--primary-color);
        }
        
        .excursion-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .excursion-card {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .excursion-image {
            height: 200px;
            position: relative;
        }
        
        .excursion-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .badge-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .badge-secondary {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .filter-container {
            background-color: white;
            border: 1px solid var(--gray-medium);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .filter-tag {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 30px;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            background-color: var(--gray-light);
            color: var(--gray-text);
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid var(--gray-medium);
        }
        
        .filter-tag:hover,
        .filter-tag.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .filter-tag i {
            margin-right: 0.5rem;
        }
        
        .icon-text {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .info-icon {
            color: var(--primary-color);
            margin-right: 0.5rem;
            width: 1rem;
            text-align: center;
        }
        
        .btn {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            font-weight: 600;
            transition: background-color 0.2s ease;
            text-align: center;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            border: none;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--gray-medium);
            color: var(--gray-text);
        }
        
        .btn-outline:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--gray-medium);
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .excursion-list-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .excursion-list-item {
            display: flex;
            flex-direction: column;
            border-radius: var(--border-radius);
            overflow: hidden;
        }
        
        @media (min-width: 768px) {
            .excursion-list-item {
                flex-direction: row;
                height: 220px;
            }
            
            .excursion-image-container {
                width: 30%;
            }
            
            .excursion-content {
                width: 70%;
                display: flex;
                flex-direction: column;
            }
        }
        
        .excursion-image-container {
            position: relative;
            height: 200px;
        }
        
        .excursion-content {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .excursion-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--secondary-color);
        }
        
        .excursion-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .excursion-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            padding-top: 1rem;
        }
        
        .excursion-price {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--secondary-color);
        }
        
        .excursion-price small {
            font-size: 0.8rem;
            color: var(--gray-text);
            font-weight: 400;
        }
        
        .filter-section {
            background-color: white;
            border-bottom: 1px solid var(--gray-medium);
            padding: 1.5rem 0;
            position: sticky;
            top: 60px;
            z-index: 10;
        }
        
        .advanced-filters {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--gray-medium);
        }
        
        @media (max-width: 768px) {
            .excursion-footer {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .filter-tags {
                display: flex;
                overflow-x: auto;
                padding-bottom: 0.5rem;
                -webkit-overflow-scrolling: touch;
            }
            
            .filter-tag {
                flex-shrink: 0;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-opensans text-gray-800">
    <%- include('../partials/navbar') %>
    
    <%- include('../partials/hero', { 
        heroTitle: 'Day Excursions in Morocco', 
        heroSubtitle: 'Discover the best day trips from Marrakech, Fes, and other Moroccan cities',
        headerImagePath: '/images/headers/excursions-header.jpg'
    }) %>
    
    <!-- Main Content -->
    <div class="container mx-auto px-4 py-12">
        <!-- Filter Section -->
        <section class="filter-section">
            <div class="container mx-auto px-4">
                <div class="filter-tags">
                    <a href="#all" class="filter-tag active">
                        <i class="fas fa-globe"></i>All Excursions
                    </a>
                    <% 
                    // Get unique start locations from excursions
                    const startLocations = [...new Set(excursions.map(excursion => excursion.startLocation))];
                    
                    // Output start location tags
                    startLocations.forEach(location => { %>
                        <a href="#<%= location.toLowerCase().replace(/\s+/g, '-') %>" class="filter-tag">
                            <i class="fas fa-map-marker-alt"></i><%= location %>
                        </a>
                    <% }); %>
                    
                    <a href="#private" class="filter-tag">
                        <i class="fas fa-user"></i>Private
                    </a>
                    <a href="#public" class="filter-tag">
                        <i class="fas fa-users"></i>Public
                    </a>
                </div>
            </div>
        </section>
        
        <!-- Excursions List -->
        <section class="py-8">
            <div class="container mx-auto px-4">
                <div class="excursion-list-container">
                    <% if (excursions && excursions.length > 0) { %>
                        <% excursions.forEach(excursion => { %>
                            <div class="card excursion-list-item" 
                                data-duration="<%= excursion.duration <= 3 ? 'short' : (excursion.duration <= 6 ? 'medium' : 'long') %>" 
                                data-location="<%= excursion.startLocation.toLowerCase().replace(/\s+/g, '-') %>" 
                                data-type="<%= excursion.excursionType %>">
                                
                                <!-- Excursion Image -->
                                <div class="excursion-image-container">
                                    <a href="/excursions/<%= excursion.slug %>">
                                        <% if (excursion.gallery && excursion.gallery.length > 0) { %>
                                            <img class="lazy-image w-full h-full object-cover" data-src="<%= excursion.gallery[0] %>" alt="<%= excursion.title %>">
                                        <% } else { %>
                                            <img class="lazy-image w-full h-full object-cover" data-src="/images/placeholder-excursion.jpg" alt="<%= excursion.title %>">
                                        <% } %>
                                    </a>
                                    <div class="absolute top-2 right-2">
                                        <span class="badge badge-<%= excursion.excursionType === 'private' ? 'primary' : 'secondary' %>">
                                            <%= excursion.excursionType %>
                                        </span>
                                    </div>
                                </div>
                                
                                <!-- Excursion Content -->
                                <div class="excursion-content">
                                    <a href="/excursions/<%= excursion.slug %>" class="block">
                                        <h3 class="excursion-title"><%= excursion.title %></h3>
                                    </a>
                                    
                                    <div class="excursion-meta">
                                        <div class="icon-text">
                                            <i class="far fa-clock info-icon"></i>
                                            <span><%= excursion.duration %> <%= excursion.durationType %></span>
                                        </div>
                                        
                                        <div class="icon-text">
                                            <i class="fas fa-map-marker-alt info-icon"></i>
                                            <span>From: <%= excursion.startLocation %></span>
                                        </div>
                                        
                                        <div class="icon-text">
                                            <i class="fas fa-users info-icon"></i>
                                            <span><%= excursion.excursionType === 'private' ? 'Private tour' : 'Group tour' %></span>
                                        </div>
                                    </div>
                                    
                                    <p class="text-gray-600 mb-4 line-clamp-2">
                                        <%- excursion.description.substring(0, 150).replace(/<[^>]*>/g, '') %>...
                                    </p>
                                    
                                    <div class="excursion-footer">
                                        <div class="excursion-price">
                                            <% if (excursion.price) { %>
                                                <%= excursion.price %> EUR
                                                <small><%= excursion.excursionType === 'private' ? 'per group' : 'per person' %></small>
                                            <% } else { %>
                                                Contact for Price
                                            <% } %>
                                        </div>
                                        
                                        <a href="/excursions/<%= excursion.slug %>" class="btn btn-primary">
                                            View Details
                                        </a>
                                    </div>
                                </div>
                            </div>
                        <% }); %>
                    <% } else { %>
                        <!-- No Excursions Message -->
                        <div class="card p-8 text-center">
                            <i class="fas fa-search text-6xl text-gray-300 mb-4"></i>
                            <h3 class="text-2xl font-semibold mb-2">No excursions available</h3>
                            <p class="text-gray-600 mb-6">Please check back later or contact us for custom excursions.</p>
                            <a href="/contact" class="btn btn-primary">
                                <i class="fas fa-envelope mr-2"></i> Contact Us
                            </a>
                        </div>
                    <% } %>
                    
                    <!-- No Results Message (initially hidden) -->
                    <div id="no-results-message" class="card p-8 text-center hidden">
                        <i class="fas fa-filter text-6xl text-gray-300 mb-4"></i>
                        <h3 class="text-2xl font-semibold mb-2">No excursions match your filters</h3>
                        <p class="text-gray-600 mb-6">Please try different filter options.</p>
                        <button id="reset-filters" class="btn btn-primary">
                            <i class="fas fa-redo-alt mr-2"></i> Reset Filters
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Call to Action Section -->
        <section class="py-12 bg-white">
            <div class="container mx-auto px-4">
                <div class="card border-0 bg-primary/10 p-8 text-center">
                    <h2 class="text-2xl font-bold mb-4">Looking for a Custom Excursion?</h2>
                    <p class="text-gray-700 mb-6">Contact us to arrange a private excursion tailored to your preferences.</p>
                    <a href="/contact" class="btn btn-primary inline-block">
                        <i class="fas fa-envelope mr-2"></i> Contact Us
                    </a>
                </div>
            </div>
        </section>
    </div>
    
    <%- include('../partials/footer') %>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Remove toggle filters function
            const toggleFiltersBtn = document.getElementById('toggle-filters');
            const filtersContainer = document.getElementById('filters-container');
            const filterButton = document.getElementById('filter-button');
            const resetFiltersBtn = document.getElementById('reset-filters-btn');
            const resetFilters = document.getElementById('reset-filters');
            const excursionItems = document.querySelectorAll('.excursion-list-item');
            const noResultsMessage = document.getElementById('no-results-message');
            
            // Remove toggle filters event listener
            toggleFiltersBtn.addEventListener('click', function() {
                filtersContainer.classList.toggle('hidden');
                const icon = toggleFiltersBtn.querySelector('.fa-chevron-down, .fa-chevron-up');
                if (icon.classList.contains('fa-chevron-down')) {
                    icon.classList.replace('fa-chevron-down', 'fa-chevron-up');
                } else {
                    icon.classList.replace('fa-chevron-up', 'fa-chevron-down');
                }
            });
            
            // Filter tags functionality
            const filterTags = document.querySelectorAll('.filter-tag');
            filterTags.forEach(tag => {
                tag.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove reset input filters code
                    // document.getElementById('duration').value = '';
                    // document.getElementById('location').value = '';
                    // document.getElementById('type').value = '';
                    
                    // Update active tag
                    filterTags.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    const filterValue = this.getAttribute('href').substring(1);
                    filterExcursions(filterValue);
                });
            });
            
            // Remove Apply filters button event listener
            // filterButton.addEventListener('click', function() {
            //     applyAdvancedFilters();
            // });
            
            // Reset filters - simplify to only deal with tag filters
            function resetAllFilters() {
                // Remove reset form inputs
                // document.getElementById('duration').value = '';
                // document.getElementById('location').value = '';
                // document.getElementById('type').value = '';
                
                // Reset filter tags
                filterTags.forEach(t => t.classList.remove('active'));
                document.querySelector('[href="#all"]').classList.add('active');
                
                // Show all excursions
                excursionItems.forEach(item => {
                    item.style.display = 'flex';
                });
                
                // Hide no results message
                noResultsMessage.classList.add('hidden');
            }
            
            // Remove resetFiltersBtn event listener
            // resetFiltersBtn.addEventListener('click', resetAllFilters);
            resetFilters.addEventListener('click', resetAllFilters);
            
            // Filter excursions by tag - keep this function
            function filterExcursions(filterValue) {
                let visibleCount = 0;
                
                excursionItems.forEach(item => {
                    if (filterValue === 'all') {
                        item.style.display = 'flex';
                        visibleCount++;
                    } else if (item.dataset.location === filterValue || item.dataset.type === filterValue) {
                        item.style.display = 'flex';
                        visibleCount++;
                    } else {
                        item.style.display = 'none';
                    }
                });
                
                // Toggle no results message
                if (visibleCount === 0) {
                    noResultsMessage.classList.remove('hidden');
                } else {
                    noResultsMessage.classList.add('hidden');
                }
            }
            
            // Lazy loading for images - keep this part
            const lazyImages = document.querySelectorAll('.lazy-image');
            
            if ('IntersectionObserver' in window) {
                const imageObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            img.src = img.dataset.src;
                            imageObserver.unobserve(img);
                        }
                    });
                });
                
                lazyImages.forEach(img => {
                    imageObserver.observe(img);
                });
            } else {
                // Fallback for browsers without IntersectionObserver support
                lazyImages.forEach(img => {
                    img.src = img.dataset.src;
                });
            }
        });
    </script>
</body>
</html> 