<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('../partials/head') %>
</head>
<body>
    <%- include('../partials/navbar') %>

    <div class="tour-container">
        <!-- Main content area -->
        <main class="tour-main">
            <!-- Image Gallery -->
            <div class="tour-gallery">
                <div class="gallery-main">
                    <img src="<%= tour.mainImage %>" alt="<%= tour.title %>">
                </div>
                <div class="gallery-nav">
                    <div class="gallery-thumb active">
                        <img src="<%= tour.mainImage %>" alt="Main view">
                    </div>
                    <% if (tour.images && tour.images.length > 0) { %>
                        <% tour.images.slice(0, 4).forEach(image => { %>
                            <div class="gallery-thumb">
                                <img src="<%= image %>" alt="Tour view">
                            </div>
                        <% }); %>
                    <% } %>
                </div>
            </div>

            <!-- Tour Header -->
            <div class="tour-header">
                <div class="tour-title">
                    <h1><%= tour.title %></h1>
                    <div class="tour-price-mobile">
                        <div class="price-current-mobile">€<%= tour.price %></div>
                        <div class="price-per-mobile">per person</div>
                    </div>
                </div>
                
                <div class="tour-meta">
                    <div class="meta-item">
                        <i class="fas fa-clock"></i>
                        <span><%= tour.duration %> <%= tour.duration === 1 ? 'Day' : 'Days' %></span>
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <span><%= tour.startLocation %></span>
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-users"></i>
                        <span>Max <%= tour.groupSize %> people</span>
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-star"></i>
                        <span>4.9 (128 reviews)</span>
                    </div>
                </div>
            </div>

            <!-- Tour Overview -->
            <div class="tour-section">
                <h2 class="section-title">Tour Overview</h2>
                <div class="tour-overview">
                    <%= tour.description %>
                </div>
            </div>

            <!-- Tour Highlights -->
            <div class="tour-section">
                <h2 class="section-title">Tour Highlights</h2>
                <div class="highlights-grid">
                    <div class="highlight-item">
                        <div class="highlight-icon">
                            <i class="fas fa-map-marked-alt"></i>
                        </div>
                        <div class="highlight-text">
                            Explore the stunning landscapes of <%= tour.startLocation %>
                        </div>
                    </div>
                    <div class="highlight-item">
                        <div class="highlight-icon">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <div class="highlight-text">
                            Experience authentic local cuisine
                        </div>
                    </div>
                    <div class="highlight-item">
                        <div class="highlight-icon">
                            <i class="fas fa-camera"></i>
                        </div>
                        <div class="highlight-text">
                            Capture breathtaking photo opportunities
                        </div>
                    </div>
                    <div class="highlight-item">
                        <div class="highlight-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="highlight-text">
                            Learn about rich cultural history with expert guides
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tour Itinerary -->
            <div class="tour-section">
                <h2 class="section-title">Tour Itinerary</h2>
                <div class="itinerary-list">
                    <% if (tour.itinerary && tour.itinerary.length > 0) { %>
                        <% tour.itinerary.forEach((day, index) => { %>
                            <div class="itinerary-item">
                                <div class="itinerary-day">
                                    <div class="itinerary-heading">
                                        <div class="day-badge">Day <%= index + 1 %></div>
                                        <div class="day-title"><%= day.title || `Day ${index + 1}` %></div>
                                    </div>
                                    <div class="itinerary-content">
                                        <%= day.description %>
                                        
                                        <% if (day.activities && day.activities.length > 0) { %>
                                            <ul class="activity-list">
                                                <% day.activities.forEach(activity => { %>
                                                    <li><%= activity %></li>
                                                <% }); %>
                                            </ul>
                                        <% } %>
                                    </div>
                                </div>
                            </div>
                        <% }); %>
                    <% } else { %>
                        <!-- Default itinerary if none provided -->
                        <div class="itinerary-item">
                            <div class="itinerary-day">
                                <div class="itinerary-heading">
                                    <div class="day-badge">Day 1</div>
                                    <div class="day-title">Start of the Journey</div>
                                </div>
                                <div class="itinerary-content">
                                    Begin your adventure in <%= tour.startLocation %> with a warm welcome from your guide.
                                    <ul class="activity-list">
                                        <li>Morning pickup from your hotel</li>
                                        <li>Visit key cultural sites</li>
                                        <li>Enjoy a traditional lunch</li>
                                        <li>Evening relaxation at accommodation</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="itinerary-item">
                            <div class="itinerary-day">
                                <div class="itinerary-heading">
                                    <div class="day-badge">Day 2</div>
                                    <div class="day-title">Exploration Day</div>
                                </div>
                                <div class="itinerary-content">
                                    Discover the hidden gems and breathtaking landscapes of the region.
                                    <ul class="activity-list">
                                        <li>Scenic morning drive</li>
                                        <li>Guided tour of important sites</li>
                                        <li>Authentic cultural experiences</li>
                                        <li>Return to accommodation</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    <% } %>
                </div>
            </div>

            <!-- Includes & Excludes -->
            <div class="tour-section">
                <h2 class="section-title">What's Included</h2>
                <div class="includes-excludes">
                    <div class="includes-box">
                        <h3 class="box-title"><i class="fas fa-check-circle"></i> Tour Includes</h3>
                        <ul class="includes-list">
                            <% if (tour.includes && tour.includes.length > 0) { %>
                                <% tour.includes.forEach(item => { %>
                                    <li><%= item %></li>
                                <% }); %>
                            <% } else { %>
                                <li>Professional English-speaking guide</li>
                                <li>Transportation in air-conditioned vehicle</li>
                                <li>Entrance fees to monuments</li>
                                <li>Bottled water during the tour</li>
                                <li>Hotel pickup and drop-off</li>
                            <% } %>
                        </ul>
                    </div>
                    
                    <div class="excludes-box">
                        <h3 class="box-title"><i class="fas fa-times-circle"></i> Tour Excludes</h3>
                        <ul class="excludes-list">
                            <% if (tour.excludes && tour.excludes.length > 0) { %>
                                <% tour.excludes.forEach(item => { %>
                                    <li><%= item %></li>
                                <% }); %>
                            <% } else { %>
                                <li>International airfare</li>
                                <li>Personal expenses</li>
                                <li>Optional activities</li>
                                <li>Travel insurance</li>
                                <li>Gratuities</li>
                            <% } %>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Tour Map -->
            <div class="tour-section">
                <h2 class="section-title">Tour Map</h2>
                <div class="tour-map">
                    <% if (tour.mapImage) { %>
                        <img src="<%= tour.mapImage %>" alt="Map of <%= tour.title %>">
                    <% } else { %>
                        <img src="/images/maps/morocco-map-generic.jpg" alt="Map of Morocco">
                    <% } %>
                </div>
            </div>

            <!-- FAQs Section -->
            <div class="tour-section">
                <h2 class="section-title">Frequently Asked Questions</h2>
                <div class="faq-list">
                    <div class="faq-item">
                        <div class="faq-question">
                            What is the best time to visit <%= tour.startLocation %>?
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="faq-answer">
                            The best time to visit <%= tour.startLocation %> is during spring (March to May) and fall (September to November) when the weather is pleasant and not too hot.
                        </div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question">
                            Is this tour suitable for children?
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="faq-answer">
                            Yes, this tour is suitable for children aged 6 and above. Children must be accompanied by an adult.
                        </div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question">
                            What should I bring on this tour?
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="faq-answer">
                            We recommend bringing comfortable walking shoes, a hat, sunscreen, sunglasses, a camera, and a light jacket or sweater for evenings.
                        </div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question">
                            What is the cancellation policy?
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="faq-answer">
                            Full refund if canceled at least 24 hours in advance. No refund for cancellations less than 24 hours before the start time.
                        </div>
                    </div>
                </div>
            </div>

          
        </main>

        <!-- Booking Sidebar -->
        <aside class="booking-sidebar">
            <div class="booking-form">
                <div class="booking-header">
                    <h2>Book This Tour</h2>
                </div>
                <div class="booking-prices">
                    <% if (tour.oldPrice) { %>
                        <div class="price-original">€<%= tour.oldPrice %></div>
                    <% } %>
                    <div class="price-current">€<%= tour.price %></div>
                    <div class="price-per">per person</div>
                </div>
                <div class="booking-form-content">
                    <form id="tour-booking-form" action="/api/bookings" method="POST">
                        <input type="hidden" name="tourId" value="<%= tour._id %>">
                        <input type="hidden" name="tourSlug" value="<%= tour.slug %>">
                        
                        <div class="form-group">
                            <label for="fullName">Full Name</label>
                            <input type="text" id="fullName" name="fullName" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <input type="email" id="email" name="email" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="phone">Phone Number</label>
                            <input type="tel" id="phone" name="phone" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label for="tourDate">Tour Date</label>
                            <input type="date" id="tourDate" name="tourDate" class="form-control" required min="<%= new Date().toISOString().split('T')[0] %>">
                        </div>
                        
                        <div class="form-group">
                            <label for="guestCount">Number of Guests</label>
                            <select id="guestCount" name="guestCount" class="form-control" required>
                                <% for(let i = 1; i <= 10; i++) { %>
                                    <option value="<%= i %>"><%= i %> <%= i === 1 ? 'person' : 'people' %></option>
                                <% } %>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="specialRequests">Special Requests</label>
                            <textarea id="specialRequests" name="specialRequests" class="form-control" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="booking-footer">
                    <button type="submit" form="tour-booking-form" class="btn-book">
                        <i class="fas fa-calendar-check"></i> Book Now
                    </button>
                    <div class="booking-guarantee">
                        <i class="fas fa-shield-alt"></i> Secure booking · Free cancellation 24h before
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- Mobile Booking Button -->
    <button class="booking-mobile-btn" id="mobile-booking-btn">
        <i class="fas fa-calendar-check"></i> Book Now - €<%= tour.price %> per person
    </button>

    <!-- Mobile Booking Modal -->
    <div class="booking-modal" id="booking-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Book <%= tour.title %></h3>
                <button class="modal-close" id="close-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Booking form content will be cloned here via JavaScript -->
            </div>
        </div>
    </div>

   

    <%- include('../partials/footer') %>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Gallery functionality
            const galleryMain = document.querySelector('.gallery-main img');
            const galleryThumbs = document.querySelectorAll('.gallery-thumb');
            
            galleryThumbs.forEach(thumb => {
                thumb.addEventListener('click', function() {
                    // Update main image
                    galleryMain.src = this.querySelector('img').src;
                    
                    // Update active state
                    galleryThumbs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // FAQ functionality
            const faqQuestions = document.querySelectorAll('.faq-question');
            
            faqQuestions.forEach(question => {
                question.addEventListener('click', function() {
                    // Toggle active state
                    this.classList.toggle('active');
                    
                    // Toggle answer visibility
                    const answer = this.nextElementSibling;
                    if (answer.style.display === 'block') {
                        answer.style.display = 'none';
                    } else {
                        answer.style.display = 'block';
                    }
                });
            });
            
            // Mobile booking functionality
            const mobileBookBtn = document.getElementById('mobile-booking-btn');
            const bookingModal = document.getElementById('booking-modal');
            const closeModalBtn = document.getElementById('close-modal');
            const bookingForm = document.querySelector('.booking-form-content');
            const modalBody = document.querySelector('.modal-body');
            
            // Clone the booking form for the modal
            if (bookingForm && modalBody) {
                modalBody.innerHTML = bookingForm.innerHTML;
            }
            
            // Open modal
            if (mobileBookBtn) {
                mobileBookBtn.addEventListener('click', function() {
                    bookingModal.style.display = 'block';
                    document.body.style.overflow = 'hidden';
                });
            }
            
            // Close modal
            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', function() {
                    bookingModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                });
            }
            
            // Close modal when clicking outside content
            window.addEventListener('click', function(event) {
                if (event.target === bookingModal) {
                    bookingModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });
            
            // Price calculation for booking form
            const guestCountSelect = document.getElementById('guestCount');
            if (guestCountSelect) {
                guestCountSelect.addEventListener('change', function() {
                    const basePrice = <%= tour.price %>;
                    const guests = parseInt(this.value);
                    const totalPrice = basePrice * guests;
                    
                    // Update displayed price if needed
                    // This is optional as the backend will calculate final price
                });
            }
        });
    </script>
</body>
</html> 