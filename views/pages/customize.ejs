<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('../partials/head') %>
  <!-- Add Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Add animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <style>
    /* Custom styles for the customize tour page */
    .form-container {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .form-header {
      text-align: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid #f0f0f0;
    }

    .form-header h2 {
      color: #2c3e50;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .form-header p {
      color: #7f8c8d;
      /* font-size: 0.95rem; */
    }

    .form-control {
      border-radius: 4px;
      border: 1px solid #e0e0e0;
      padding: 0.6rem 1rem;
      transition: all 0.3s ease;
    }

    .form-control:focus {
      border-color: #3498db;
      box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
    }

    .form-label {
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: #34495e;
    }

    .required-asterisk {
      color: #e74c3c;
      margin-left: 2px;
    }

    .btn-custom-primary {
      background-color: #3498db;
      border-color: #3498db;
      color: white;
      padding: 0.75rem 2rem;
      font-weight: 500;
      border-radius: 4px;
      transition: all 0.3s ease;
    }

    .btn-custom-primary:hover {
      background-color: #2980b9;
      border-color: #2980b9;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .form-section {
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #f0f0f0;
    }

    .section-title {
      /* font-size: 1.1rem; */
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 1.5rem;
    }

    .captcha-container {
      background-color: #f8f9fa;
      border-radius: 4px;
      padding: 1rem;
      border: 1px solid #e0e0e0;
    }

    .captcha-input {
      max-width: 120px;
      margin-left: 10px;
    }

    .captcha-label {
      display: flex;
      align-items: center;
      font-weight: 500;
    }

    .field-icon {
      margin-right: 8px;
      color: #3498db;
    }

    .success-icon {
      color: #2ecc71;
    }

    .info-text {
      /* font-size: 0.85rem; */
      color: #7f8c8d;
      margin-top: 0.5rem;
    }

    .is-invalid {
      border-color: #e74c3c !important;
    }

    .is-valid {
      border-color: #2ecc71 !important;
    }

    .invalid-feedback {
      display: none;
      color: #e74c3c;
      /* font-size: 0.85rem; */
      margin-top: 0.25rem;
    }

    /* Card hover effects */
    .info-card {
      transition: all 0.3s ease;
    }
    
    .info-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 20px rgba(0,0,0,0.1) !important;
    }
    
    /* Icon pulse effect */
    .icon-pulse {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.1);
      }
      100% {
        transform: scale(1);
      }
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .form-container {
        padding: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <%- include('../partials/navbar') %>
  
  <%- include('../partials/hero', { heroTitle, heroSubtitle, headerImagePath: '/images/headers/customize-bg.jpg' }) %>

  <div class="container mx-auto px-4 py-12">
    <div class="flex justify-center">
      <div class="w-full lg:w-10/12">
        <!-- Page Introduction -->
        <div class="text-center mb-12 animate__animated animate__fadeIn">
          <h2 class="text-3xl font-montserrat font-bold mb-4 text-secondary">Design Your Perfect Morocco Experience</h2>
          <p class="text-gray-600 max-w-3xl mx-auto">Tell us what you're looking for, and our travel experts will create a customized journey just for you.</p>
        </div>
        
        <div class="form-container animate__animated animate__fadeInUp">
          <div class="form-header">
            <h2 class="text-2xl font-semibold text-secondary">Customize Your Tour</h2>
            <p class="text-gray-500">Fields marked with <span class="required-asterisk">*</span> are required</p>
          </div>
          
          <% if (typeof success !== 'undefined' && success) { %>
            <div class="bg-success/10 text-success rounded-md p-4 mb-6 animate__animated animate__fadeIn">
              <div class="flex items-start">
                <i class="fas fa-check-circle text-2xl mr-3 mt-0.5"></i>
                <div>
                  <h5 class="font-semibold mb-1">Thank you for your request!</h5>
                  <p>We've received your tour customization details and will contact you shortly to discuss your dream Morocco adventure.</p>
                </div>
              </div>
            </div>
          <% } %>

          <% if (typeof error !== 'undefined' && error) { %>
            <div class="bg-accent/10 text-accent rounded-md p-4 mb-6 animate__animated animate__fadeIn">
              <div class="flex items-start">
                <i class="fas fa-exclamation-triangle text-2xl mr-3 mt-0.5"></i>
                <p><%= error %></p>
              </div>
            </div>
          <% } %>

          <form action="/customize" method="POST" id="customTourForm">
            <!-- Honeypot field - hidden from humans but bots will fill it -->
            <div class="hidden">
              <label for="website">Website (leave empty)</label>
              <input type="text" id="website" name="website" autocomplete="off">
            </div>
            
            <!-- Personal Information Section -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="fas fa-user field-icon"></i>
                Personal Information
              </h3>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label for="fullName" class="form-label">Full Name <span class="required-asterisk">*</span></label>
                  <input 
                    type="text" 
                    class="form-control" 
                    id="fullName" 
                    name="fullName" 
                    required
                    value="<%= typeof formData !== 'undefined' ? formData.fullName || '' : '' %>"
                  >
                  <div class="invalid-feedback">Please enter your full name (minimum 3 characters)</div>
                </div>
                
                <div>
                  <label for="email" class="form-label">Email Address <span class="required-asterisk">*</span></label>
                  <input 
                    type="email" 
                    class="form-control" 
                    id="email" 
                    name="email" 
                    required
                    value="<%= typeof formData !== 'undefined' ? formData.email || '' : '' %>"
                  >
                  <div class="invalid-feedback">Please enter a valid email address</div>
                </div>
                
                <div>
                  <label for="phone" class="form-label">Phone Number <span class="required-asterisk">*</span></label>
                  <input 
                    type="tel" 
                    class="form-control" 
                    id="phone" 
                    name="phone" 
                    required
                    placeholder="+1 (123) 456-7890"
                    value="<%= typeof formData !== 'undefined' ? formData.phone || '' : '' %>"
                  >
                  <div class="invalid-feedback">Please enter a valid phone number</div>
                  <small class="info-text">We may contact you regarding your tour request</small>
                </div>
              </div>
            </div>
            
            <!-- Tour Details Section -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="fas fa-calendar-alt field-icon"></i>
                Tour Details
              </h3>
              
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div>
                  <label for="startDate" class="form-label">Preferred Start Date <span class="required-asterisk">*</span></label>
                  <input 
                    type="date" 
                    class="form-control" 
                    id="startDate" 
                    name="startDate" 
                    required
                    min="<%= new Date().toISOString().split('T')[0] %>"
                    value="<%= typeof formData !== 'undefined' ? formData.startDate || '' : '' %>"
                  >
                  <div class="invalid-feedback">Please select a start date</div>
                </div>
                
                <div>
                  <label for="duration" class="form-label">Duration (days) <span class="required-asterisk">*</span></label>
                  <input 
                    type="number" 
                    class="form-control" 
                    id="duration" 
                    name="duration" 
                    min="1" 
                    max="30" 
                    required
                    value="<%= typeof formData !== 'undefined' ? formData.duration || '7' : '7' %>"
                  >
                  <div class="invalid-feedback">Please enter a duration between 1-30 days</div>
                </div>
                
                <div>
                  <label for="groupSize" class="form-label">Number of Travelers <span class="required-asterisk">*</span></label>
                  <input 
                    type="number" 
                    class="form-control" 
                    id="groupSize" 
                    name="groupSize" 
                    min="1" 
                    max="20" 
                    required
                    value="<%= typeof formData !== 'undefined' ? formData.groupSize || '2' : '2' %>"
                  >
                  <div class="invalid-feedback">Please enter a group size between 1-20 people</div>
                </div>
              </div>

              <div>
                <label for="requestDetails" class="form-label">Your Tour Requirements <span class="required-asterisk">*</span></label>
                <textarea 
                  class="form-control" 
                  id="requestDetails" 
                  name="requestDetails" 
                  rows="6" 
                  required
                  placeholder="Please describe your ideal tour, including destinations you'd like to visit, types of activities, accommodation preferences, and any special requirements."
                ><%= typeof formData !== 'undefined' ? formData.requestDetails || '' : '' %></textarea>
                <div class="invalid-feedback">Please provide more details about your tour request (minimum 20 characters)</div>
                <small class="info-text">The more details you provide, the better we can customize your experience</small>
              </div>
            </div>

            <!-- Security Section -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="fas fa-shield-alt field-icon"></i>
                Security Check
              </h3>
              
              <div class="captcha-container mb-6">
                <div class="flex items-center flex-wrap">
                  <span class="mr-2">What is <span id="num1" class="font-bold">3</span> + <span id="num2" class="font-bold">5</span>? <span class="required-asterisk">*</span></span>
                  <input type="number" class="form-control w-24 ml-2" id="mathCaptcha" name="mathCaptcha" required>
                  <input type="hidden" id="expectedAnswer" name="expectedAnswer">
                  <div class="invalid-feedback w-full mt-2">Please enter the correct answer</div>
                </div>
              </div>
            </div>

            <div class="text-center mt-8">
              <p class="text-sm text-gray-500 mb-6">By submitting this form, you agree to our <a href="/terms-of-service" class="text-primary hover:underline">Terms of Service</a> and <a href="/privacy-policy" class="text-primary hover:underline">Privacy Policy</a>.</p>
              <button type="submit" class="btn-custom-primary animate__animated animate__pulse animate__infinite animate__slower">
                <i class="fas fa-paper-plane mr-2"></i>
                Submit Request
              </button>
            </div>
          </form>
        </div>
        
        <!-- Additional Information -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-16">
          <div class="info-card">
            <div class="text-center p-6">
              <i class="fas fa-check-circle text-4xl text-primary mb-4 icon-pulse"></i>
              <h4 class="text-xl font-semibold mb-3 text-secondary">Personalized Service</h4>
              <p class="text-gray-600">Our travel experts will create a customized itinerary based on your preferences and interests.</p>
            </div>
          </div>
          
          <div class="info-card">
            <div class="text-center p-6">
              <i class="fas fa-map-marked-alt text-4xl text-primary mb-4 icon-pulse"></i>
              <h4 class="text-xl font-semibold mb-3 text-secondary">Local Expertise</h4>
              <p class="text-gray-600">Our guides are local experts who know Morocco's hidden gems and authentic experiences.</p>
            </div>
          </div>
          
          <div class="info-card">
            <div class="text-center p-6">
              <i class="fas fa-clock text-4xl text-primary mb-4 icon-pulse"></i>
              <h4 class="text-xl font-semibold mb-3 text-secondary">Quick Response</h4>
              <p class="text-gray-600">We'll respond to your request within 24 hours with a customized proposal for your dream trip.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Set up math captcha
      const num1 = Math.floor(Math.random() * 10);
      const num2 = Math.floor(Math.random() * 10);
      document.getElementById('num1').textContent = num1;
      document.getElementById('num2').textContent = num2;
      document.getElementById('expectedAnswer').value = num1 + num2;
      
      // Form validation with visual feedback
      const form = document.getElementById('customTourForm');
      const inputs = form.querySelectorAll('input, textarea');
      
      // Add input event listeners for real-time validation
      inputs.forEach(input => {
        if (input.id !== 'website') { // Skip honeypot field
          input.addEventListener('input', function() {
            validateInput(this);
          });
          
          input.addEventListener('blur', function() {
            validateInput(this);
          });
        }
      });
      
      // Function to validate a single input
      function validateInput(input) {
        let isValid = true;
        const errorElement = input.nextElementSibling;
        
        // Remove existing validation classes
        input.classList.remove('is-valid', 'is-invalid');
        
        // Validate based on input type
        switch(input.id) {
          case 'fullName':
            isValid = input.value.trim().length >= 3;
            break;
            
          case 'email':
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            isValid = emailRegex.test(input.value.trim());
            break;
            
          case 'phone':
            isValid = input.value.trim().length >= 10;
            break;
            
          case 'startDate':
            isValid = input.value !== '';
            break;
            
          case 'duration':
            isValid = parseInt(input.value) >= 1 && parseInt(input.value) <= 30;
            break;
            
          case 'groupSize':
            isValid = parseInt(input.value) >= 1 && parseInt(input.value) <= 20;
            break;
            
          case 'requestDetails':
            isValid = input.value.trim().length >= 20;
            break;
            
          case 'mathCaptcha':
            isValid = parseInt(input.value) === parseInt(document.getElementById('expectedAnswer').value);
            break;
        }
        
        // Add appropriate validation class
        if (input.value.trim() === '') {
          // Don't show validation for empty fields until form submission
          return;
        } else if (isValid) {
          input.classList.add('is-valid');
          if (errorElement && errorElement.classList.contains('invalid-feedback')) {
            errorElement.style.display = 'none';
          }
        } else {
          input.classList.add('is-invalid');
          if (errorElement && errorElement.classList.contains('invalid-feedback')) {
            errorElement.style.display = 'block';
          }
        }
        
        return isValid;
      }
      
      // Form submission validation
      form.addEventListener('submit', function(event) {
        let isValid = true;
        const errorMessages = [];
        
        // Validate all inputs
        inputs.forEach(input => {
          if (input.id !== 'website' && input.id !== 'expectedAnswer') { // Skip honeypot field and hidden fields
            if (!validateInput(input)) {
              isValid = false;
              const label = input.previousElementSibling.textContent.replace('*', '').trim();
              
              // Only add message if not already in the array
              const message = `Please enter a valid ${label.toLowerCase()}`;
              if (!errorMessages.includes(message)) {
                errorMessages.push(message);
              }
            }
          }
        });
        
        // Check honeypot
        if (document.getElementById('website').value.trim() !== '') {
          isValid = false; // Bot detected, silently reject
        }
        
        // If validation fails, prevent form submission and show errors
        if (!isValid) {
          event.preventDefault();
          
          // Create or update error alert
          let errorAlert = document.querySelector('.bg-accent\\/10');
          if (!errorAlert) {
            errorAlert = document.createElement('div');
            errorAlert.className = 'bg-accent/10 text-accent rounded-md p-4 mb-6 animate__animated animate__headShake';
            const formHeader = document.querySelector('.form-header');
            formHeader.insertAdjacentElement('afterend', errorAlert);
          } else {
            errorAlert.classList.add('animate__animated', 'animate__headShake');
          }
          
          errorAlert.innerHTML = `
            <div class="flex items-start">
              <i class="fas fa-exclamation-triangle text-2xl mr-3 mt-0.5"></i>
              <div>
                <h5 class="font-semibold mb-1">Please fix the following errors:</h5>
                <p>${errorMessages.join('<br>')}</p>
              </div>
            </div>
          `;
          
          // Scroll to the top of the form
          window.scrollTo({
            top: errorAlert.offsetTop - 100,
            behavior: 'smooth'
          });
        }
      });
    });
  </script>

  <%- include('../partials/footer') %>
</body>
</html> 