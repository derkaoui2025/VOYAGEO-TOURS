<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <%- include('./partials/dashboad-head') %>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen" x-data="{ mobileMenuOpen: false }">
        <!-- Header -->
        <header class="bg-white shadow-sm">
            <div class="container mx-auto px-4 py-3">
                <div class="flex items-center justify-between">
                    <!-- Logo -->
                    <div class="flex items-center">
                        <h1 class="text-2xl font-bold text-primary">Voyageo Admin</h1>
                    </div>
                    
                    <!-- Profile Dropdown (Desktop) -->
                    <div class="hidden md:flex items-center space-x-4">
                        <div class="dropdown dropdown-end">
                            <label tabindex="0" class="btn btn-ghost btn-circle avatar">
                                <div class="w-10 rounded-full bg-primary text-primary-content flex items-center justify-center">
                                    <i class="fas fa-user text-lg"></i>
                                </div>
                            </label>
                            <ul tabindex="0" class="mt-3 z-[1] p-2 shadow menu menu-sm dropdown-content bg-base-100 rounded-box w-52">
                                <li><a href="/admin/profile"><i class="fas fa-user-cog mr-2"></i> Profile</a></li>
                                <li><a href="/admin/settings"><i class="fas fa-cog mr-2"></i> Settings</a></li>
                                <li><a href="/admin/logout"><i class="fas fa-sign-out-alt mr-2"></i> Logout</a></li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Mobile Menu Button -->
                    <button 
                        @click="mobileMenuOpen = !mobileMenuOpen" 
                        class="md:hidden btn btn-ghost btn-circle"
                    >
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
            
            <!-- Mobile Menu -->
            <div 
                x-show="mobileMenuOpen" 
                @click.away="mobileMenuOpen = false"
                x-transition:enter="transition ease-out duration-200"
                x-transition:enter-start="opacity-0 transform scale-95"
                x-transition:enter-end="opacity-100 transform scale-100"
                x-transition:leave="transition ease-in duration-100"
                x-transition:leave-start="opacity-100 transform scale-100"
                x-transition:leave-end="opacity-0 transform scale-95"
                class="md:hidden bg-white border-t absolute w-full z-10 shadow-md"
            >
                <div class="container mx-auto px-4 py-2">
                    <ul class="space-y-2">
                        <li><a href="/admin/dashboard" class="block px-4 py-2 hover:bg-gray-100 rounded-lg">Dashboard</a></li>
                        <li><a href="/admin/tours" class="block px-4 py-2 hover:bg-gray-100 rounded-lg">Tours</a></li>
                        <li><a href="/admin/excursions" class="block px-4 py-2 hover:bg-gray-100 rounded-lg">Excursions</a></li>
                        <li><a href="/admin/bookings" class="block px-4 py-2 hover:bg-gray-100 rounded-lg">All Bookings</a></li>
                        <li><a href="/admin/transfers" class="block px-4 py-2 hover:bg-gray-100 rounded-lg">Transfers</a></li>
                        <li><a href="/admin/activities" class="block px-4 py-2 hover:bg-gray-100 rounded-lg">Activities</a></li>
                        <li><a href="/admin/blog" class="block px-4 py-2 hover:bg-gray-100 rounded-lg">Blog</a></li>
                        <li><a href="/admin/logout" class="block px-4 py-2 text-red-500 hover:bg-red-50 rounded-lg">Logout</a></li>
                    </ul>
                </div>
            </div>
        </header>
        
        <!-- Main Navigation -->
        <nav class="bg-white shadow-sm border-t hidden md:block">
            <div class="container mx-auto px-4">
                <ul class="flex overflow-x-auto">
                    <li><a href="/admin/dashboard" class="px-4 py-3 inline-block text-primary border-b-2 border-primary font-medium">Dashboard</a></li>
                    <li><a href="/admin/tours" class="px-4 py-3 inline-block text-gray-600 hover:text-primary">Tours</a></li>
                    <li><a href="/admin/excursions" class="px-4 py-3 inline-block text-gray-600 hover:text-primary">Excursions</a></li>
                    <li><a href="/admin/bookings" class="px-4 py-3 inline-block text-gray-600 hover:text-primary">All Bookings</a></li>
                    <li><a href="/admin/transfers" class="px-4 py-3 inline-block text-gray-600 hover:text-primary">Transfers</a></li>
                    <li><a href="/admin/activities" class="px-4 py-3 inline-block text-gray-600 hover:text-primary">Activities</a></li>
                    <li><a href="/admin/blog" class="px-4 py-3 inline-block text-gray-600 hover:text-primary">Blog</a></li>
                </ul>
            </div>
        </nav>
        
        <!-- Main Content -->
        <main class="container mx-auto px-4 py-6">
            <!-- Welcome Section -->
            <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4 mb-6">
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-800">Welcome, <%= session.adminUsername || 'Admin' %></h1>
                    <p class="text-gray-500">Dashboard overview</p>
                </div>
                <div class="badge badge-neutral gap-2 px-4 py-3 text-sm">
                    <i class="fas fa-calendar-alt"></i>
                    <%= new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric', year: 'numeric' }) %>
                </div>
            </div>
            
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="card bg-white shadow-sm hover:shadow-md transition-shadow cursor-pointer">
                    <div class="card-body p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-3xl font-bold text-primary"><%= stats.bookings + stats.excursionBookings + stats.transferBookings + stats.activityBookings %></h2>
                                <p class="text-gray-500 mt-1">Total Bookings</p>
                            </div>
                            <div class="bg-primary/10 p-3 rounded-full">
                                <i class="fas fa-calendar-check text-primary text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card bg-white shadow-sm hover:shadow-md transition-shadow cursor-pointer">
                    <div class="card-body p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-3xl font-bold text-secondary"><%= stats.tours %></h2>
                                <p class="text-gray-500 mt-1">Tours</p>
                            </div>
                            <div class="bg-secondary/10 p-3 rounded-full">
                                <i class="fas fa-map-marked-alt text-secondary text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card bg-white shadow-sm hover:shadow-md transition-shadow cursor-pointer">
                    <div class="card-body p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-3xl font-bold text-accent"><%= stats.excursions %></h2>
                                <p class="text-gray-500 mt-1">Excursions</p>
                            </div>
                            <div class="bg-accent/10 p-3 rounded-full">
                                <i class="fas fa-hiking text-accent text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card bg-white shadow-sm hover:shadow-md transition-shadow cursor-pointer">
                    <div class="card-body p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-3xl font-bold text-info"><%= stats.transfers %></h2>
                                <p class="text-gray-500 mt-1">Transfers</p>
                            </div>
                            <div class="bg-info/10 p-3 rounded-full">
                                <i class="fas fa-car text-info text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Custom Transfer Requests Card -->
            <div class="card bg-white shadow-sm mb-8">
                <div class="card-body p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="card-title text-gray-800">Custom Transfer Requests</h2>
                        <a href="/admin/custom-transfers" class="btn btn-sm btn-ghost">
                            View All <i class="fas fa-chevron-right ml-1"></i>
                        </a>
                    </div>
                    <div class="stats shadow">
                        <div class="stat">
                            <div class="stat-figure text-primary">
                                <i class="fas fa-car-side text-3xl"></i>
                            </div>
                            <div class="stat-title">Pending Requests</div>
                            <div class="stat-value text-primary"><%= stats.customTransfersPending || 0 %></div>
                            <div class="stat-desc">Require your attention</div>
                        </div>
                        
                        <div class="stat">
                            <div class="stat-figure text-secondary">
                                <i class="fas fa-check-circle text-3xl"></i>
                            </div>
                            <div class="stat-title">Total Requests</div>
                            <div class="stat-value text-secondary"><%= stats.customTransfersTotal || 0 %></div>
                            <div class="stat-desc">All time</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="card bg-white shadow-sm mb-8">
                <div class="card-body p-6">
                    <h2 class="card-title text-gray-800 mb-4">Quick Actions</h2>
                    <div class="flex flex-wrap gap-3">
                        <a href="/admin/tours/new" class="btn btn-primary btn-sm">
                            <i class="fas fa-plus mr-2"></i> Add Tour
                        </a>
                        <a href="/admin/excursions/new" class="btn btn-secondary btn-sm">
                            <i class="fas fa-plus mr-2"></i> Add Excursion
                        </a>
                        <a href="/admin/transfers/new" class="btn btn-info btn-sm">
                            <i class="fas fa-plus mr-2"></i> Add Transfer
                        </a>
                        <a href="/admin/activities/new" class="btn btn-accent btn-sm">
                            <i class="fas fa-plus mr-2"></i> Add Activity
                        </a>
                        <a href="/admin/custom-transfers" class="btn btn-warning btn-sm">
                            <i class="fas fa-car-side mr-2"></i> Custom Transfer Requests
                        </a>
                        <a href="/admin/bookings" class="btn btn-outline btn-sm">
                            <i class="fas fa-list mr-2"></i> View All Bookings
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Recent Bookings and Stats -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Recent Bookings -->
                <div class="card bg-white shadow-sm lg:col-span-2">
                    <div class="card-body p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="card-title text-gray-800">Recent Bookings</h2>
                            <div class="tabs tabs-boxed bg-base-200">
                                <a class="tab tab-active" id="tab-all-bookings">All</a>
                                <a class="tab" id="tab-tour-bookings">Tours</a>
                                <a class="tab" id="tab-excursion-bookings">Excursions</a>
                            </div>
                        </div>
                        
                        <!-- All Bookings Table -->
                        <div id="all-bookings-table" class="overflow-x-auto">
                            <table class="table table-zebra w-full">
                                <thead>
                                    <tr>
                                        <th>Customer</th>
                                        <th>Type</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% if (recentBookings && recentBookings.length > 0) { %>
                                        <% recentBookings.slice(0, 5).forEach(booking => { %>
                                            <tr>
                                                <td><%= booking.fullName %></td>
                                                <td>Tour</td>
                                                <td><%= new Date(booking.tourDate).toLocaleDateString() %></td>
                                                <td>
                                                    <% let statusClass = "badge"; 
                                                       switch(booking.status) {
                                                            case 'confirmed': statusClass += " badge-success"; break;
                                                            case 'pending': statusClass += " badge-warning"; break;
                                                            case 'cancelled': statusClass += " badge-error"; break;
                                                            case 'completed': statusClass += " badge-info"; break;
                                                            default: statusClass += " badge-neutral";
                                                       }
                                                    %>
                                                    <span class="<%= statusClass %>"><%= booking.status %></span>
                                                </td>
                                                <td>
                                                    <a href="/admin/bookings/<%= booking._id %>" class="btn btn-ghost btn-xs">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                </td>
                                            </tr>
                                        <% }) %>
                                    <% } %>
                                    
                                    <% if (typeof recentExcursionBookings !== 'undefined' && recentExcursionBookings && recentExcursionBookings.length > 0) { %>
                                        <% recentExcursionBookings.slice(0, 5).forEach(booking => { %>
                                            <tr>
                                                <td><%= booking.fullName %></td>
                                                <td>Excursion</td>
                                                <td><%= new Date(booking.excursionDate).toLocaleDateString() %></td>
                                                <td>
                                                    <% let statusClass = "badge"; 
                                                       switch(booking.status) {
                                                            case 'confirmed': statusClass += " badge-success"; break;
                                                            case 'pending': statusClass += " badge-warning"; break;
                                                            case 'cancelled': statusClass += " badge-error"; break;
                                                            case 'completed': statusClass += " badge-info"; break;
                                                            default: statusClass += " badge-neutral";
                                                       }
                                                    %>
                                                    <span class="<%= statusClass %>"><%= booking.status %></span>
                                                </td>
                                                <td>
                                                    <a href="/admin/excursion-bookings/<%= booking._id %>" class="btn btn-ghost btn-xs">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                </td>
                                            </tr>
                                        <% }) %>
                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Tour Bookings Table -->
                        <div id="tour-bookings-table" class="overflow-x-auto hidden">
                            <table class="table table-zebra w-full">
                                <thead>
                                    <tr>
                                        <th>Customer</th>
                                        <th>Tour</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% if (recentBookings && recentBookings.length > 0) { %>
                                        <% recentBookings.forEach(booking => { %>
                                            <tr>
                                                <td><%= booking.fullName %></td>
                                                <td><%= booking.tourName %></td>
                                                <td><%= new Date(booking.tourDate).toLocaleDateString() %></td>
                                                <td>
                                                    <% let statusClass = "badge"; 
                                                       switch(booking.status) {
                                                            case 'confirmed': statusClass += " badge-success"; break;
                                                            case 'pending': statusClass += " badge-warning"; break;
                                                            case 'cancelled': statusClass += " badge-error"; break;
                                                            case 'completed': statusClass += " badge-info"; break;
                                                            default: statusClass += " badge-neutral";
                                                       }
                                                    %>
                                                    <span class="<%= statusClass %>"><%= booking.status %></span>
                                                </td>
                                                <td>
                                                    <a href="/admin/bookings/<%= booking._id %>" class="btn btn-ghost btn-xs">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                </td>
                                            </tr>
                                        <% }) %>
                                    <% } else { %>
                                        <tr>
                                            <td colspan="5" class="text-center py-4">No tour bookings found</td>
                                        </tr>
                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Excursion Bookings Table -->
                        <div id="excursion-bookings-table" class="overflow-x-auto hidden">
                            <table class="table table-zebra w-full">
                                <thead>
                                    <tr>
                                        <th>Customer</th>
                                        <th>Excursion</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% if (typeof recentExcursionBookings !== 'undefined' && recentExcursionBookings && recentExcursionBookings.length > 0) { %>
                                        <% recentExcursionBookings.forEach(booking => { %>
                                            <tr>
                                                <td><%= booking.fullName %></td>
                                                <td><%= booking.excursionName %></td>
                                                <td><%= new Date(booking.excursionDate).toLocaleDateString() %></td>
                                                <td>
                                                    <% let statusClass = "badge"; 
                                                       switch(booking.status) {
                                                            case 'confirmed': statusClass += " badge-success"; break;
                                                            case 'pending': statusClass += " badge-warning"; break;
                                                            case 'cancelled': statusClass += " badge-error"; break;
                                                            case 'completed': statusClass += " badge-info"; break;
                                                            default: statusClass += " badge-neutral";
                                                       }
                                                    %>
                                                    <span class="<%= statusClass %>"><%= booking.status %></span>
                                                </td>
                                                <td>
                                                    <a href="/admin/excursion-bookings/<%= booking._id %>" class="btn btn-ghost btn-xs">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                </td>
                                            </tr>
                                        <% }) %>
                                    <% } else { %>
                                        <tr>
                                            <td colspan="5" class="text-center py-4">No excursion bookings found</td>
                                        </tr>
                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Activity Summary -->
                <div class="card bg-white shadow-sm">
                    <div class="card-body p-6">
                        <h2 class="card-title text-gray-800 mb-4">Recent Activity</h2>
                        
                        <% if (recentActivity && recentActivity.length > 0) { %>
                            <div class="space-y-4">
                                <% recentActivity.slice(0, 5).forEach(activity => { %>
                                    <div class="flex gap-3 pb-3 border-b">
                                        <div class="avatar">
                                            <div class="w-10 h-10 rounded-full bg-base-200 flex items-center justify-center">
                                                <i class="<%= activity.icon %> opacity-60"></i>
                                            </div>
                                        </div>
                                        <div>
                                            <p class="text-sm"><%= activity.text %></p>
                                            <p class="text-xs opacity-60 mt-1"><%= activity.time %></p>
                                        </div>
                                    </div>
                                <% }) %>
                            </div>
                        <% } else { %>
                            <div class="py-8 text-center">
                                <div class="mask mask-squircle mx-auto w-12 h-12 bg-base-200 flex items-center justify-center mb-2">
                                    <i class="fas fa-history opacity-60"></i>
                                </div>
                                <p class="font-medium">No recent activity</p>
                                <p class="text-sm opacity-60">Activity will be shown here</p>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="bg-white border-t mt-10 py-4">
            <div class="container mx-auto px-4 text-center text-gray-500">
                <p>© <%= new Date().getFullYear() %> Voyageo Tours. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <!-- Scripts -->
    <script>
        $(document).ready(function() {
            // Tabs functionality
            $('#tab-all-bookings').click(function() {
                $(this).addClass('tab-active');
                $('#tab-tour-bookings, #tab-excursion-bookings').removeClass('tab-active');
                
                $('#all-bookings-table').removeClass('hidden');
                $('#tour-bookings-table, #excursion-bookings-table').addClass('hidden');
            });
            
            $('#tab-tour-bookings').click(function() {
                $(this).addClass('tab-active');
                $('#tab-all-bookings, #tab-excursion-bookings').removeClass('tab-active');
                
                $('#tour-bookings-table').removeClass('hidden');
                $('#all-bookings-table, #excursion-bookings-table').addClass('hidden');
            });
            
            $('#tab-excursion-bookings').click(function() {
                $(this).addClass('tab-active');
                $('#tab-all-bookings, #tab-tour-bookings').removeClass('tab-active');
                
                $('#excursion-bookings-table').removeClass('hidden');
                $('#all-bookings-table, #tour-bookings-table').addClass('hidden');
            });
        });
    </script>
</body>
</html> 